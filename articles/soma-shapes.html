<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>SOMA shapes • tiledbsoma</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SOMA shapes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tiledbsoma</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><h6 class="dropdown-header" data-toc-skip>SOMA Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/soma-objects.html">SOMA Objects Overview</a></li>
    <li><a class="dropdown-item" href="../articles/soma-reading.html">Reading From SOMA Objects</a></li>
    <li><a class="dropdown-item" href="../articles/soma-shapes.html">SOMA shapes</a></li>
    <li><a class="dropdown-item" href="../articles/soma-experiment-queries.html">Querying a SOMA Experiment</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>SOMA Configuration</h6></li>
    <li><a class="dropdown-item" href="../articles/UsingPlatformConfig.html">Using PlatformConfig</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/single-cell-data/TileDB-SOMA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>SOMA shapes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/single-cell-data/TileDB-SOMA/blob/2.3.0rc0/vignettes/soma-shapes.Rmd" class="external-link"><code>vignettes/soma-shapes.Rmd</code></a></small>
      <div class="d-none name"><code>soma-shapes.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>As of TileDB-SOMA 1.15 we’re proud to support a more intuitive and
extensible notion of shape.</p>
<p>Please also see the <a href="https://cloud.tiledb.com/academy/structure/life-sciences/single-cell/tutorials/shapes/" class="external-link">Academy
tutorial</a>.</p>
</div>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>Let’s load the bundled <code>SOMAExperiment</code> containing a
subsetted version of the 10X genomics <a href="https://satijalab.github.io/seurat-object/reference/pbmc_small.html" class="external-link">PBMC
dataset</a> provided by SeuratObject. This will return a
<code>SOMAExperiment</code> object.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://single-cell-data.github.io/TileDB-SOMA/" class="external-link">tiledbsoma</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/example-datasets.html">load_dataset</a></span><span class="op">(</span><span class="st">"soma-exp-pbmc-small"</span><span class="op">)</span></span>
<span><span class="va">exp</span></span>
<span><span class="co">#&gt; &lt;SOMAExperiment&gt;</span></span>
<span><span class="co">#&gt;   uri: /tmp/RtmpNZLR4Y/soma-exp-pbmc-small</span></span></code></pre></div>
<p>The <code>obs</code> dataframe has a <code>domain</code>, which is a
soft limit on what values can be written to it. (You’ll get an error if
you try to read or write <code>soma_joinid</code> values outside this
range, which is an important data-integrity reassurance.)</p>
<p>The <code>domain</code> we see here matches with the data populated
inside of it. (This will usually be the case. It might not, if you’ve
created the dataframe but not written any data to it yet — at that point
it’s empty but it still has a shape.)</p>
<p>If you have more data — more cells — to add to the experiment later,
you will be able resize the obs, up to the maxdomain which is a hard
limit.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="fu">domain</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $soma_joinid</span></span>
<span><span class="co">#&gt; [1]  0 79</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="fu">maxdomain</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $soma_joinid</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 0                   9223372036854773759</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">exp</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="fu">read</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">concat</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   soma_joinid    orig.ident nCount_RNA nFeature_RNA RNA_snn_res.0.8</span></span>
<span><span class="co">#&gt; 1           0 SeuratProject         70           47               0</span></span>
<span><span class="co">#&gt; 2           1 SeuratProject         85           52               0</span></span>
<span><span class="co">#&gt; 3           2 SeuratProject         87           50               1</span></span>
<span><span class="co">#&gt; 4           3 SeuratProject        127           56               0</span></span>
<span><span class="co">#&gt; 5           4 SeuratProject        173           53               0</span></span>
<span><span class="co">#&gt; 6           5 SeuratProject         70           48               0</span></span>
<span><span class="co">#&gt;   letter.idents groups RNA_snn_res.1         obs_id</span></span>
<span><span class="co">#&gt; 1             A     g2             0 ATGCCAGAACGACT</span></span>
<span><span class="co">#&gt; 2             A     g1             0 CATGGCCTGTGCAT</span></span>
<span><span class="co">#&gt; 3             B     g2             0 GAACCTGATGAACC</span></span>
<span><span class="co">#&gt; 4             A     g2             0 TGACTGGATTCTCA</span></span>
<span><span class="co">#&gt; 5             A     g2             0 AGTCAGACTGCACA</span></span>
<span><span class="co">#&gt; 6             A     g1             0 TCTGATACACGTGT</span></span></code></pre></div>
<p>The <code>var</code> dataframe’s <code>domain</code> is similar:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var</span> <span class="op">&lt;-</span> <span class="va">exp</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"RNA"</span><span class="op">)</span><span class="op">$</span><span class="va">var</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var</span><span class="op">$</span><span class="fu">domain</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $soma_joinid</span></span>
<span><span class="co">#&gt; [1]   0 229</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var</span><span class="op">$</span><span class="fu">maxdomain</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $soma_joinid</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 0                   9223372036854773759</span></span></code></pre></div>
<p>Likewise, the N-dimensional arrays within the experiment have their
shapes as well.</p>
<p>There’s an important difference: while the dataframe domain gives you
the inclusive lower and upper bounds for <code>soma_joinid</code>
writes, the shape for the N-dimensional arrays is the upper bound plus
1.</p>
<p>Since there are 80 cells here and 230 genes here, <code>X</code>’s
shape reflects that.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="va">exp</span><span class="op">$</span><span class="va">obs</span></span>
<span><span class="va">var</span> <span class="op">&lt;-</span> <span class="va">exp</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"RNA"</span><span class="op">)</span><span class="op">$</span><span class="va">var</span></span>
<span><span class="va">X</span>   <span class="op">&lt;-</span> <span class="va">exp</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"RNA"</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs</span><span class="op">$</span><span class="fu">domain</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $soma_joinid</span></span>
<span><span class="co">#&gt; [1]  0 79</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var</span><span class="op">$</span><span class="fu">domain</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $soma_joinid</span></span>
<span><span class="co">#&gt; [1]   0 229</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span><span class="op">$</span><span class="fu">shape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 80  230</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span><span class="op">$</span><span class="fu">maxshape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 9223372036854775728 9223372036854775578</span></span></code></pre></div>
<p>The other N-dimensional arrays are similar:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obsm</span> <span class="op">&lt;-</span> <span class="va">exp</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"RNA"</span><span class="op">)</span><span class="op">$</span><span class="va">obsm</span></span>
<span><span class="va">obsm</span><span class="op">$</span><span class="fu">names</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "X_pca"  "X_tsne"</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obsp</span> <span class="op">&lt;-</span> <span class="va">exp</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"RNA"</span><span class="op">)</span><span class="op">$</span><span class="va">obsp</span></span>
<span><span class="va">obsp</span><span class="op">$</span><span class="fu">names</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "RNA_snn"</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">obsm</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"X_pca"</span><span class="op">)</span><span class="op">$</span><span class="fu">shape</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="va">obsm</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"X_pca"</span><span class="op">)</span><span class="op">$</span><span class="fu">maxshape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 80 19</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 9223372036854775728 9223372036854775789</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">obsp</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"RNA_snn"</span><span class="op">)</span><span class="op">$</span><span class="fu">shape</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="va">obsp</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"RNA_snn"</span><span class="op">)</span><span class="op">$</span><span class="fu">maxshape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 80 80</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 9223372036854775728 9223372036854775728</span></span></code></pre></div>
<p>In particular, the <code>X</code> array in this experiment — and in
most experiments — is sparse. That means there needn’t be a number in
every row or cell of the matrix. Nonetheless, the shape serves as a soft
limit for reads and writes: you’ll get an exception trying to read or
write outside of these.</p>
<p>As a general rule you’ll see the following:</p>
<ul>
<li>An <code>X</code> array’s shape is nobs x nvar</li>
<li>An <code>obsm</code> array’s shape is <code>nobs</code> x some
number, maybe 20</li>
<li>An <code>obsp</code> array’s shape is <code>nobs</code> x
<code>nobs</code>
</li>
<li>A <code>varm</code> array’s shape is <code>nvar</code> x some
number, maybe 20</li>
<li>A <code>varp</code> array’s shape is <code>nvar</code> x
<code>nvar</code>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="advanced-usage-dataframes-with-non-standard-index-columns">Advanced usage: dataframes with non-standard index columns<a class="anchor" aria-label="anchor" href="#advanced-usage-dataframes-with-non-standard-index-columns"></a>
</h2>
<p>In the SOMA data model, the <code>SOMASparseNDArray</code> and
<code>SOMADenseNDArray</code> objects always have int64 dimensions named
<code>soma_dim_0</code>, <code>soma_dim_1</code>, and up, and they have
a numeric <code>soma_data</code> attribute for the contents of the
array. Furthermore, this is always the case.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"RNA"</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span><span class="op">$</span><span class="fu">schema</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Schema</span></span>
<span><span class="co">#&gt; soma_dim_0: int64 not null</span></span>
<span><span class="co">#&gt; soma_dim_1: int64 not null</span></span>
<span><span class="co">#&gt; soma_data: double not null</span></span></code></pre></div>
<p>For dataframes, though, while there must be a
<code>soma_joinid</code> column of type int64, you can have one or more
other index columns in addtion — or, <code>soma_joinid</code> can be a
non-index column.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="fu">schema</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Schema</span></span>
<span><span class="co">#&gt; soma_joinid: int64 not null</span></span>
<span><span class="co">#&gt; orig.ident: dictionary&lt;values=string, indices=int8&gt;</span></span>
<span><span class="co">#&gt; nCount_RNA: double</span></span>
<span><span class="co">#&gt; nFeature_RNA: int32</span></span>
<span><span class="co">#&gt; RNA_snn_res.0.8: dictionary&lt;values=string, indices=int8&gt;</span></span>
<span><span class="co">#&gt; letter.idents: dictionary&lt;values=string, indices=int8&gt;</span></span>
<span><span class="co">#&gt; groups: large_string</span></span>
<span><span class="co">#&gt; RNA_snn_res.1: dictionary&lt;values=string, indices=int8&gt;</span></span>
<span><span class="co">#&gt; obs_id: large_string</span></span></code></pre></div>
<p>But really, dataframes are capable of more than that, via the
index-column names you specify at creation time.</p>
<p>Let’s create a couple dataframes, with the same data, but different
choices of index-column names.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdfuri1</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">local_tempdir</a></span><span class="op">(</span><span class="st">"sdf1"</span><span class="op">)</span></span>
<span><span class="va">sdfuri2</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">local_tempdir</a></span><span class="op">(</span><span class="st">"sdf2"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">asch</span> <span class="op">&lt;-</span> <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/schema.html" class="external-link">schema</a></span><span class="op">(</span></span>
<span>    <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/Field.html" class="external-link">field</a></span><span class="op">(</span><span class="st">"soma_joinid"</span>, <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/data-type.html" class="external-link">int64</a></span><span class="op">(</span><span class="op">)</span>, nullable <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/Field.html" class="external-link">field</a></span><span class="op">(</span><span class="st">"mystring"</span>, <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/data-type.html" class="external-link">large_utf8</a></span><span class="op">(</span><span class="op">)</span>, nullable <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/Field.html" class="external-link">field</a></span><span class="op">(</span><span class="st">"myint"</span>, <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/data-type.html" class="external-link">int32</a></span><span class="op">(</span><span class="op">)</span>, nullable <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/Field.html" class="external-link">field</a></span><span class="op">(</span><span class="st">"myfloat"</span>, <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/data-type.html" class="external-link">float32</a></span><span class="op">(</span><span class="op">)</span>, nullable <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">soma_joinid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mystring</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hello"</span>, <span class="st">"world"</span><span class="op">)</span></span>
<span><span class="va">myint</span>       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">33</span>, <span class="fl">44</span><span class="op">)</span></span>
<span><span class="va">myfloat</span>     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.5</span>, <span class="fl">5.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/table.html" class="external-link">arrow_table</a></span><span class="op">(</span></span>
<span>    soma_joinid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">soma_joinid</span><span class="op">)</span>,</span>
<span>    mystring <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mystring</span><span class="op">)</span>,</span>
<span>    myint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">myint</span><span class="op">)</span>,</span>
<span>    myfloat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">myfloat</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOMADataFrameCreate.html">SOMADataFrameCreate</a></span><span class="op">(</span></span>
<span>  <span class="va">sdfuri1</span>,</span>
<span>  <span class="va">asch</span>,</span>
<span>  index_column_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"soma_joinid"</span>, <span class="st">"mystring"</span><span class="op">)</span>,</span>
<span>  domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>soma_joinid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">9</span><span class="op">)</span>, mystring <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sdf1</span><span class="op">$</span><span class="fu">write</span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span>
<span><span class="va">sdf1</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s look at the <code>domain</code> and <code>maxdomain</code>
for these dataframes.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOMADataFrameOpen.html">SOMADataFrameOpen</a></span><span class="op">(</span><span class="va">sdfuri1</span><span class="op">)</span></span>
<span><span class="va">sdf1</span><span class="op">$</span><span class="fu">index_column_names</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "soma_joinid" "mystring"</span></span></code></pre></div>
<p>Here we see the <code>soma_joinid</code> slot of the dataframe’s
domain is as requested.</p>
<p>Another point is that domain cannot be specified for string-type
index columns. You can set them at create one of two ways:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>domain <span class="ot">=</span> <span class="fu">list</span>(<span class="at">soma_joinid =</span> (<span class="dv">0</span>, <span class="dv">9</span>), <span class="at">mystring =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>domain <span class="ot">=</span> <span class="fu">list</span>(<span class="at">soma_joinid =</span> (<span class="dv">0</span>, <span class="dv">9</span>), <span class="at">mystring =</span> <span class="fu">c</span>(<span class="st">''</span>, <span class="st">''</span>))</span></code></pre></div>
<p>and in either case the domain slot for a string-typed index column
will read back as <code>('', '')</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf1</span><span class="op">$</span><span class="fu">domain</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $soma_joinid</span></span>
<span><span class="co">#&gt; [1] 0 9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mystring</span></span>
<span><span class="co">#&gt; [1] "" ""</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf1</span><span class="op">$</span><span class="fu">maxdomain</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $soma_joinid</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 0                   9223372036854773759</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mystring</span></span>
<span><span class="co">#&gt; [1] "" ""</span></span></code></pre></div>
<p>Now let’s look at our other dataframe. Here <code>soma_joinid</code>
is not an index column at all. This is fine, as long as within the data
you write to it, the index-column values uniquely identify each row.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOMADataFrameCreate.html">SOMADataFrameCreate</a></span><span class="op">(</span></span>
<span>  <span class="va">sdfuri2</span>,</span>
<span>  <span class="va">asch</span>,</span>
<span>  index_column_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"myfloat"</span>, <span class="st">"myint"</span><span class="op">)</span>,</span>
<span>  domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>myfloat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">9999</span><span class="op">)</span>, myint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1000</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sdf2</span><span class="op">$</span><span class="fu">write</span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span>
<span><span class="va">sdf2</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOMADataFrameOpen.html">SOMADataFrameOpen</a></span><span class="op">(</span><span class="va">sdfuri1</span><span class="op">)</span></span>
<span><span class="va">sdf2</span><span class="op">$</span><span class="fu">index_column_names</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "soma_joinid" "mystring"</span></span></code></pre></div>
<p>The domain reads back as written:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf2</span><span class="op">$</span><span class="fu">domain</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $soma_joinid</span></span>
<span><span class="co">#&gt; [1] 0 9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mystring</span></span>
<span><span class="co">#&gt; [1] "" ""</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf2</span><span class="op">$</span><span class="fu">maxdomain</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $soma_joinid</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 0                   9223372036854773759</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mystring</span></span>
<span><span class="co">#&gt; [1] "" ""</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="advanced-usage-using-resize-at-the-dataframearray-level">Advanced usage: using resize at the dataframe/array level<a class="anchor" aria-label="anchor" href="#advanced-usage-using-resize-at-the-dataframearray-level"></a>
</h2>
<p>In the TileDB-SOMA Python API, there is a method for resizing all the
dataframes and arrays within an experiment. At present we do not yet
offer a corresponding method in the TileDB-SOMA R API, for the simple
reason that there is low demand for it. Nonetheless, for completeness,
we offer here guidance on how to resizes dataframes and arrays within a
TileDB-SOMA experiment.</p>
<p>For N-dimensional arrays that have been upgraded, or that were
created using TileDB-SOMA 1.15 or higher, simply do the following:</p>
<ul>
<li>If the array’s <code>$tiledbsoma_has_upgraded_shape()</code> reports
<code>FALSE</code>, invoke the <code>$tiledbsoma_upgrade_shape()</code>
method.</li>
<li>Otherwise invoke the <code>$.resize()</code> method.</li>
</ul>
<p>Let’s do a fresh unpack of a pre-1.15 experiment:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/example-datasets.html">load_dataset</a></span><span class="op">(</span><span class="st">"soma-exp-pbmc-small-pre-1.15"</span><span class="op">)</span></span>
<span><span class="va">exp</span></span>
<span><span class="co">#&gt; &lt;SOMAExperiment&gt;</span></span>
<span><span class="co">#&gt;   uri: /tmp/RtmpNZLR4Y/soma-exp-pbmc-small-pre-1.15</span></span></code></pre></div>
<p>Here we see that the X array has not been upgraded, and that its
shape reports the same as maxshape:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">exp</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"RNA"</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span><span class="va">X</span><span class="op">$</span><span class="fu">tiledbsoma_has_upgraded_shape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span><span class="op">$</span><span class="fu">shape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 80  230</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span><span class="op">$</span><span class="fu">maxshape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 80  230</span></span></code></pre></div>
<p>Given that pre-1.15 TileDB-SOMA-R arrays were created with a maxshape
leaving no room for growth, these arrays cannot have their shape resized
any further. From 1.15 onward, of course, as we’ve see above, arrays are
created with room for growth and you can resize them upward.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Hoffman, Aaron Wolen, TileDB, Inc..</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
