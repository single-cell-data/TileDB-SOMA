<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="800.3005px" preserveAspectRatio="none" style="width:762px;height:800px;background:#FFFFFF;" version="1.1" viewBox="0 0 762 800" width="762.8934px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="610.9684" style="stroke:#181818;stroke-width:0.5268600888047377;" width="5.2686" x="563.7403" y="142.9684"/><rect fill="#FFFFFF" height="593.9524" style="stroke:#181818;stroke-width:0.5268600888047377;" width="5.2686" x="703.0948" y="183.2362"/><rect fill="none" height="448.4197" style="stroke:#000000;stroke-width:0.7902901332071065;" width="711.2611" x="48.4711" y="226.1382"/><rect fill="none" height="131.8179" style="stroke:#000000;stroke-width:0.7902901332071065;" width="700.7239" x="53.7397" y="539.052"/><line style="stroke:#181818;stroke-width:0.26343004440236883;stroke-dasharray:5.0,5.0;" x1="86.4051" x2="86.4051" y1="19.1234" y2="781.9303"/><line style="stroke:#181818;stroke-width:0.26343004440236883;stroke-dasharray:5.0,5.0;" x1="271.0695" x2="271.0695" y1="19.1234" y2="781.9303"/><line style="stroke:#181818;stroke-width:0.26343004440236883;stroke-dasharray:5.0,5.0;" x1="402.5211" x2="402.5211" y1="19.1234" y2="781.9303"/><line style="stroke:#181818;stroke-width:0.26343004440236883;stroke-dasharray:5.0,5.0;" x1="566.1112" x2="566.1112" y1="142.7132" y2="781.9303"/><line style="stroke:#181818;stroke-width:0.26343004440236883;stroke-dasharray:5.0,5.0;" x1="705.4657" x2="705.4657" y1="182.981" y2="781.9303"/><rect fill="#E3E3E3" height="15.9622" rx="1.3172" ry="1.3172" style="stroke:#181818;stroke-width:0.26343004440236883;" width="55.3203" x="59.0083" y="2.6343"/><text fill="#000000" font-family="sans-serif" font-size="7.376" lengthAdjust="spacing" textLength="47.9443" x="62.6964" y="13.1689">user app (py)</text><rect fill="#E3E3E3" height="15.9622" rx="1.3172" ry="1.3172" style="stroke:#181818;stroke-width:0.26343004440236883;" width="55.3203" x="59.0083" y="781.4035"/><text fill="#000000" font-family="sans-serif" font-size="7.376" lengthAdjust="spacing" textLength="47.9443" x="62.6964" y="791.9381">user app (py)</text><rect fill="#E3E3E3" height="15.9622" rx="1.3172" ry="1.3172" style="stroke:#181818;stroke-width:0.26343004440236883;" width="63.2232" x="239.4579" y="2.6343"/><text fill="#000000" font-family="sans-serif" font-size="7.376" lengthAdjust="spacing" textLength="55.8472" x="243.1459" y="13.1689">tiledbsoma (py)</text><rect fill="#E3E3E3" height="15.9622" rx="1.3172" ry="1.3172" style="stroke:#181818;stroke-width:0.26343004440236883;" width="63.2232" x="239.4579" y="781.4035"/><text fill="#000000" font-family="sans-serif" font-size="7.376" lengthAdjust="spacing" textLength="55.8472" x="243.1459" y="791.9381">tiledbsoma (py)</text><rect fill="#E3E3E3" height="15.9622" rx="1.3172" ry="1.3172" style="stroke:#181818;stroke-width:0.26343004440236883;" width="79.5559" x="363.0066" y="2.6343"/><text fill="#000000" font-family="sans-serif" font-size="7.376" lengthAdjust="spacing" textLength="72.1798" x="366.6946" y="13.1689">libtiledbsoma (c++)</text><rect fill="#E3E3E3" height="15.9622" rx="1.3172" ry="1.3172" style="stroke:#181818;stroke-width:0.26343004440236883;" width="79.5559" x="363.0066" y="781.4035"/><text fill="#000000" font-family="sans-serif" font-size="7.376" lengthAdjust="spacing" textLength="72.1798" x="366.6946" y="791.9381">libtiledbsoma (c++)</text><rect fill="#E3E3E3" height="15.9622" rx="1.3172" ry="1.3172" style="stroke:#181818;stroke-width:0.26343004440236883;" width="79.5559" x="526.5967" y="781.4035"/><text fill="#000000" font-family="sans-serif" font-size="7.376" lengthAdjust="spacing" textLength="72.1798" x="530.2847" y="791.9381">SOMAArrayReader (c++)</text><rect fill="#E3E3E3" height="15.9622" rx="1.3172" ry="1.3172" style="stroke:#181818;stroke-width:0.26343004440236883;" width="86.9319" x="662.2631" y="781.4035"/><text fill="#000000" font-family="sans-serif" font-size="7.376" lengthAdjust="spacing" textLength="79.5559" x="665.9512" y="791.9381">ManagedQuery (c++)</text><rect fill="#FFFFFF" height="610.9684" style="stroke:#181818;stroke-width:0.5268600888047377;" width="5.2686" x="563.7403" y="142.9684"/><rect fill="#FFFFFF" height="593.9524" style="stroke:#181818;stroke-width:0.5268600888047377;" width="5.2686" x="703.0948" y="183.2362"/><path d="M52.1591,27.0263 L52.1591,40.1978 L739.7116,40.1978 L739.7116,32.2949 L734.443,27.0263 L52.1591,27.0263 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><path d="M734.443,27.0263 L734.443,32.2949 L739.7116,32.2949 L734.443,27.0263 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="199.1531" x="293.9879" y="36.0181">Open SOMADataFrame|SOMASparseNdArray in read mode</text><path d="M2.6343,45.5364 L2.6343,74.5137 L170.7027,74.5137 L170.7027,50.805 L165.4341,45.5364 L2.6343,45.5364 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><path d="M165.4341,45.5364 L165.4341,50.805 L170.7027,50.805 L165.4341,45.5364 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="55.3203" x="5.7955" y="54.5282">SPEC CHANGE</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="157.0043" x="5.7955" y="62.5011">- platform_config passed once to create object</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="68.4918" x="5.7955" y="70.474">- open in read mode</text><polygon fill="#181818" points="264.7472,86.3845,270.0158,88.4919,264.7472,90.5994,266.8546,88.4919" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="86.6685" x2="267.9084" y1="88.4919" y2="88.4919"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="4.7417" x="90.3565" y="85.8229">1</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="164.9072" x="97.2057" y="85.8229">a = SOMA*.open(uri, platform_config, mode="r")</text><path d="M195.4651,95.3411 L195.4651,108.5126 L346.6739,108.5126 L346.6739,100.6097 L341.4053,95.3411 L195.4651,95.3411 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><path d="M341.4053,95.3411 L341.4053,100.6097 L346.6739,100.6097 L341.4053,95.3411 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="140.1448" x="198.6263" y="104.333">Extract tiledb_config from platform_config</text><polygon fill="#181818" points="396.4622,120.2435,401.7308,122.3509,396.4622,124.4583,398.5697,122.3509" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="271.0695" x2="399.6234" y1="122.3509" y2="122.3509"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="4.7417" x="274.7575" y="119.6819">2</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="104.3183" x="281.6067" y="119.6819">SOMAArrayReader(uri, tiledb_config)</text><polygon fill="#181818" points="520.2743,135.5924,525.5429,137.6998,520.2743,139.8073,522.3818,137.6998" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="402.7845" x2="523.4355" y1="137.6998" y2="137.6998"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="4.7417" x="406.4726" y="135.0308">3</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="104.3183" x="413.3217" y="135.0308">SOMAArrayReader(uri, tiledb_config)</text><rect fill="#E3E3E3" height="15.9622" rx="1.3172" ry="1.3172" style="stroke:#181818;stroke-width:0.26343004440236883;" width="79.5559" x="526.5967" y="126.5658"/><text fill="#000000" font-family="sans-serif" font-size="7.376" lengthAdjust="spacing" textLength="72.1798" x="530.2847" y="137.1004">SOMAArrayReader (c++)</text><path d="M486.2919,150.9578 L486.2919,164.1293 L645.9305,164.1293 L645.9305,156.2264 L640.6619,150.9578 L486.2919,150.9578 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><path d="M640.6619,150.9578 L640.6619,156.2264 L645.9305,156.2264 L640.6619,150.9578 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="148.5745" x="489.453" y="159.9496">Open array using timestamp in tiledb_config</text><polygon fill="#181818" points="655.9408,175.8601,661.2094,177.9676,655.9408,180.075,658.0483,177.9676" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="569.0089" x2="659.102" y1="177.9676" y2="177.9676"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="4.7417" x="572.6969" y="175.2985">4</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="73.7604" x="579.5461" y="175.2985">ManagedQuery(array)</text><rect fill="#E3E3E3" height="15.9622" rx="1.3172" ry="1.3172" style="stroke:#181818;stroke-width:0.26343004440236883;" width="86.9319" x="662.2631" y="166.8335"/><text fill="#000000" font-family="sans-serif" font-size="7.376" lengthAdjust="spacing" textLength="79.5559" x="665.9512" y="177.3682">ManagedQuery (c++)</text><polygon fill="#181818" points="92.4639,197.6178,87.1953,199.7253,92.4639,201.8327,90.3565,199.7253" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="89.3028" x2="270.5427" y1="199.7253" y2="199.7253"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="4.7417" x="95.6251" y="197.0562">5</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="4.2149" x="102.4743" y="197.0562">a</text><path d="M52.1591,206.5744 L52.1591,219.7459 L739.7116,219.7459 L739.7116,211.843 L734.443,206.5744 L52.1591,206.5744 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><path d="M734.443,206.5744 L734.443,211.843 L739.7116,211.843 L734.443,206.5744 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="128.5539" x="329.2876" y="215.5663">Mulitple reads to the same open array</text><path d="M48.4711,226.1382 L89.0394,226.1382 L89.0394,229.8962 L83.7708,235.1648 L48.4711,235.1648 L48.4711,226.1382 " fill="#EEEEEE" style="stroke:#000000;stroke-width:0.7902901332071065;"/><rect fill="none" height="448.4197" style="stroke:#000000;stroke-width:0.7902901332071065;" width="711.2611" x="48.4711" y="226.1382"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="16.8595" x="56.374" y="233.0227">loop</text><text fill="#000000" font-family="sans-serif" font-size="5.7955" font-weight="bold" lengthAdjust="spacing" textLength="53.7397" x="96.9423" y="232.5714">[Multiple reads]</text><polygon fill="#181818" points="264.7472,252.1643,270.0158,254.2717,264.7472,256.3792,266.8546,254.2717" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="86.6685" x2="267.9084" y1="254.2717" y2="254.2717"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="4.7417" x="90.3565" y="247.6163">6</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="132.2419" x="97.2057" y="243.6298">a.read(ids, column_names, value_filter,</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="83.2439" x="99.3131" y="251.6027">batch_size, result_order)</text><polygon fill="#181818" points="396.4622,275.4861,401.7308,277.5935,396.4622,279.701,398.5697,277.5935" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="271.0695" x2="399.6234" y1="277.5935" y2="277.5935"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="4.7417" x="274.7575" y="270.9381">7</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="112.2212" x="281.6067" y="266.9516">reset(column_names, value_filter</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="83.2439" x="283.7142" y="274.9245">batch_size, result_order)</text><polygon fill="#181818" points="557.418,298.8079,562.6866,300.9153,557.418,303.0228,559.5254,300.9153" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="402.7845" x2="560.5791" y1="300.9153" y2="300.9153"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="4.7417" x="406.4726" y="294.2598">8</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="73.7604" x="413.3217" y="290.2734">reset(column_names,</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="83.2439" x="415.4292" y="298.2463">batch_size, result_order)</text><polygon fill="#181818" points="696.7725,314.1568,702.0411,316.2642,696.7725,318.3717,698.8799,316.2642" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="569.0089" x2="699.9336" y1="316.2642" y2="316.2642"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="4.7417" x="572.6969" y="313.5952">9</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="22.655" x="579.5461" y="313.5952">reset()</text><polygon fill="#181818" points="696.7725,329.5057,702.0411,331.6131,696.7725,333.7206,698.8799,331.6131" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="569.0089" x2="699.9336" y1="331.6131" y2="331.6131"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="572.6969" y="328.9441">10</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="57.4277" x="584.2878" y="328.9441">select_columns()</text><polygon fill="#181818" points="696.7725,344.8546,702.0411,346.9621,696.7725,349.0695,698.8799,346.9621" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="569.0089" x2="699.9336" y1="346.9621" y2="346.9621"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="572.6969" y="344.293">11</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="40.0414" x="584.2878" y="344.293">set_layout()</text><polygon fill="#181818" points="557.418,360.2035,562.6866,362.311,557.418,364.4184,559.5254,362.311" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="402.7845" x2="560.5791" y1="362.311" y2="362.311"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="406.4726" y="359.642">12</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="50.0517" x="418.0635" y="359.642">set_condition()</text><polygon fill="#181818" points="696.7725,375.5525,702.0411,377.6599,696.7725,379.7673,698.8799,377.6599" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="569.0089" x2="699.9336" y1="377.6599" y2="377.6599"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="572.6969" y="374.9909">13</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="50.0517" x="584.2878" y="374.9909">set_condition()</text><polygon fill="#181818" points="396.4622,390.9014,401.7308,393.0088,396.4622,395.1163,398.5697,393.0088" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="271.0695" x2="399.6234" y1="393.0088" y2="393.0088"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="274.7575" y="390.3398">14</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="56.374" x="286.3485" y="390.3398">set_dim_points()</text><polygon fill="#181818" points="557.418,406.2503,562.6866,408.3577,557.418,410.4652,559.5254,408.3577" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="402.7845" x2="560.5791" y1="408.3577" y2="408.3577"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="406.4726" y="405.6887">15</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="56.374" x="418.0635" y="405.6887">set_dim_points()</text><polygon fill="#181818" points="696.7725,421.5992,702.0411,423.7066,696.7725,425.8141,698.8799,423.7066" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="569.0089" x2="699.9336" y1="423.7066" y2="423.7066"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="572.6969" y="421.0376">16</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="56.374" x="584.2878" y="421.0376">set_dim_points()</text><polygon fill="#181818" points="396.4622,436.9481,401.7308,439.0556,396.4622,441.163,398.5697,439.0556" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="271.0695" x2="399.6234" y1="439.0556" y2="439.0556"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="274.7575" y="436.3865">17</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="59.0083" x="286.3485" y="436.3865">set_dim_ranges()</text><polygon fill="#181818" points="557.418,452.297,562.6866,454.4045,557.418,456.5119,559.5254,454.4045" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="402.7845" x2="560.5791" y1="454.4045" y2="454.4045"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="406.4726" y="451.7354">18</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="59.0083" x="418.0635" y="451.7354">set_dim_ranges()</text><polygon fill="#181818" points="696.7725,467.646,702.0411,469.7534,696.7725,471.8608,698.8799,469.7534" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="569.0089" x2="699.9336" y1="469.7534" y2="469.7534"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="572.6969" y="467.0844">19</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="59.0083" x="584.2878" y="467.0844">set_dim_ranges()</text><polygon fill="#181818" points="396.4622,482.9949,401.7308,485.1023,396.4622,487.2098,398.5697,485.1023" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="271.0695" x2="399.6234" y1="485.1023" y2="485.1023"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="274.7575" y="482.4333">20</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="28.4504" x="286.3485" y="482.4333">submit()</text><polygon fill="#181818" points="557.418,498.3438,562.6866,500.4512,557.418,502.5587,559.5254,500.4512" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="402.7845" x2="560.5791" y1="500.4512" y2="500.4512"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="406.4726" y="497.7822">21</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="28.4504" x="418.0635" y="497.7822">submit()</text><polygon fill="#181818" points="696.7725,513.6927,702.0411,515.8001,696.7725,517.9076,698.8799,515.8001" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="569.0089" x2="699.9336" y1="515.8001" y2="515.8001"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="572.6969" y="513.1311">22</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="28.4504" x="584.2878" y="513.1311">submit()</text><polygon fill="#181818" points="92.4639,529.0416,87.1953,531.1491,92.4639,533.2565,90.3565,531.1491" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="89.3028" x2="270.5427" y1="531.1491" y2="531.1491"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="95.6251" y="528.48">23</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="11.0641" x="107.216" y="528.48">iter</text><path d="M53.7397,539.052 L94.308,539.052 L94.308,542.81 L89.0394,548.0786 L53.7397,548.0786 L53.7397,539.052 " fill="#EEEEEE" style="stroke:#000000;stroke-width:0.7902901332071065;"/><rect fill="none" height="131.8179" style="stroke:#000000;stroke-width:0.7902901332071065;" width="700.7239" x="53.7397" y="539.052"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="16.8595" x="61.6426" y="545.9364">loop</text><text fill="#000000" font-family="sans-serif" font-size="5.7955" font-weight="bold" lengthAdjust="spacing" textLength="81.1365" x="102.2109" y="545.4852">[while iter returns data]</text><polygon fill="#181818" points="264.7472,557.1052,270.0158,559.2126,264.7472,561.32,266.8546,559.2126" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="86.6685" x2="267.9084" y1="559.2126" y2="559.2126"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="90.3565" y="556.5436">24</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="33.1922" x="101.9474" y="556.5436">iter.next()</text><polygon fill="#181818" points="396.4622,572.4541,401.7308,574.5615,396.4622,576.6689,398.5697,574.5615" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="271.0695" x2="399.6234" y1="574.5615" y2="574.5615"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="274.7575" y="571.8925">25</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="38.9876" x="286.3485" y="571.8925">read_next()</text><polygon fill="#181818" points="557.418,587.803,562.6866,589.9104,557.418,592.0179,559.5254,589.9104" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="402.7845" x2="560.5791" y1="589.9104" y2="589.9104"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="406.4726" y="587.2414">26</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="38.9876" x="418.0635" y="587.2414">read_next()</text><polygon fill="#181818" points="696.7725,603.1519,702.0411,605.2593,696.7725,607.3668,698.8799,605.2593" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="569.0089" x2="699.9336" y1="605.2593" y2="605.2593"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="572.6969" y="602.5903">27</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="27.9236" x="584.2878" y="602.5903">results()</text><polygon fill="#181818" points="574.8044,618.5008,569.5358,620.6083,574.8044,622.7157,572.6969,620.6083" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="571.6432" x2="702.5679" y1="620.6083" y2="620.6083"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="577.9655" y="617.9392">28</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="64.2769" x="589.5564" y="617.9392">data [ArrayBuffers]</text><polygon fill="#181818" points="408.58,633.8497,403.3114,635.9572,408.58,638.0646,406.4726,635.9572" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="405.4188" x2="563.2134" y1="635.9572" y2="635.9572"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="411.7412" y="633.2881">29</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="64.2769" x="423.3321" y="633.2881">data [ArrayBuffers]</text><polygon fill="#181818" points="276.865,649.1986,271.5964,651.3061,276.865,653.4135,274.7575,651.3061" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="273.7038" x2="402.2577" y1="651.3061" y2="651.3061"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="280.0261" y="648.6371">30</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="61.6426" x="291.6171" y="648.6371">data [Arrow Table]</text><polygon fill="#181818" points="92.4639,664.5476,87.1953,666.655,92.4639,668.7624,90.3565,666.655" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="89.3028" x2="270.5427" y1="666.655" y2="666.655"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="95.6251" y="663.986">31</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="61.6426" x="107.216" y="663.986">data [Arrow Table]</text><path d="M52.1591,680.8802 L52.1591,694.0517 L739.7116,694.0517 L739.7116,686.1488 L734.443,680.8802 L52.1591,680.8802 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><path d="M734.443,680.8802 L734.443,686.1488 L739.7116,686.1488 L734.443,680.8802 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="126.4464" x="330.3413" y="689.8721">Delete SOMASparseNdArray instance</text><polygon fill="#181818" points="264.7472,705.7826,270.0158,707.89,264.7472,709.9975,266.8546,707.89" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="86.6685" x2="267.9084" y1="707.89" y2="707.89"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="90.3565" y="705.221">32</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="28.9773" x="101.9474" y="705.221">a.close()</text><polygon fill="#181818" points="396.4622,721.1315,401.7308,723.239,396.4622,725.3464,398.5697,723.239" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="271.0695" x2="399.6234" y1="723.239" y2="723.239"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="274.7575" y="720.5699">33</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="22.655" x="286.3485" y="720.5699">close()</text><polygon fill="#181818" points="557.418,736.4804,562.6866,738.5879,557.418,740.6953,559.5254,738.5879" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="402.7845" x2="560.5791" y1="738.5879" y2="738.5879"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="406.4726" y="735.9188">34</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="55.3203" x="418.0635" y="735.9188">~SOMAArrayReader()</text><polygon fill="#181818" points="696.7725,751.8293,702.0411,753.9368,696.7725,756.0442,698.8799,753.9368" style="stroke:#181818;stroke-width:0.5268600888047377;"/><line style="stroke:#181818;stroke-width:0.5268600888047377;" x1="566.3746" x2="699.9336" y1="753.9368" y2="753.9368"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" font-weight="bold" lengthAdjust="spacing" textLength="9.4835" x="570.0626" y="751.2678">35</text><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="62.1695" x="581.6535" y="751.2678">~ManagedQuery()</text><path d="M679.1227,760.786 L679.1227,773.9575 L731.8087,773.9575 L731.8087,766.0546 L726.5401,760.786 L679.1227,760.786 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><path d="M726.5401,760.786 L726.5401,766.0546 L731.8087,766.0546 L726.5401,760.786 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.26343004440236883;"/><text fill="#000000" font-family="sans-serif" font-size="6.8492" lengthAdjust="spacing" textLength="41.6219" x="682.2838" y="769.7778">Array closed</text><!--MD5=[615d76611a65728c698c32461378559f]
@startuml

skinparam monochrome true
scale 800 height
autonumber
' autoactivate on

participant "user app (py)" as py
participant "tiledbsoma (py)" as soma
participant "libtiledbsoma (c++)" as clib
participant "SOMAArrayReader (c++)" as sr
participant "ManagedQuery (c++)" as mq


' =====================================
note across: Open SOMADataFrame|SOMASparseNdArray in read mode

note over py: **SPEC CHANGE**\n- platform_config passed once to create object\n- open in read mode
py -> soma : a = SOMA*.open(uri, platform_config, mode="r")
note over soma: Extract tiledb_config from platform_config
soma -> clib : SOMAArrayReader(uri, tiledb_config)
clib -> sr ** : SOMAArrayReader(uri, tiledb_config)
sr++
note over sr: Open array using timestamp in tiledb_config

sr -> mq ** : ManagedQuery(array)
mq ++
soma -> py : a

' =====================================
note across: Mulitple reads to the same open array
loop Multiple reads
    py -> soma : a.read(ids, column_names, value_filter,\n batch_size, result_order)
    soma -> clib : reset(column_names, value_filter\n batch_size, result_order)
    clib -> sr : reset(column_names,\n batch_size, result_order)
    sr -> mq : reset()
    sr -> mq : select_columns()
    sr -> mq : set_layout()

    clib -> sr : set_condition()
    sr -> mq : set_condition()

    soma -> clib : set_dim_points()
    clib -> sr : set_dim_points()
    sr -> mq : set_dim_points()

    soma -> clib : set_dim_ranges()
    clib -> sr : set_dim_ranges()
    sr -> mq : set_dim_ranges()

    soma -> clib : submit()
    clib -> sr : submit()
    sr -> mq : submit()
    soma -> py : iter


    loop while iter returns data
        py -> soma : iter.next()
        soma -> clib : read_next()
        clib -> sr : read_next()
        sr -> mq : results()
        mq -> sr : data [ArrayBuffers]
        sr -> clib : data [ArrayBuffers]
        clib -> soma : data [Arrow Table]
        soma -> py : data [Arrow Table]
    end
end

' =====================================
note across: Delete SOMASparseNdArray instance

py -> soma : a.close()
soma -> clib : close()
clib -> sr - - : ~SOMAArrayReader()
sr -> mq - - : ~ManagedQuery()
note over mq : Array closed

@enduml

@startuml

skinparam monochrome true
scale 800 height
autonumber

participant "user app (py)" as py
participant "tiledbsoma (py)" as soma
participant "libtiledbsoma (c++)" as clib
participant "SOMAArrayReader (c++)" as sr
participant "ManagedQuery (c++)" as mq


note across: Open SOMADataFrame|SOMASparseNdArray in read mode

note over py: **SPEC CHANGE**\n- platform_config passed once to create object\n- open in read mode
py -> soma : a = SOMA*.open(uri, platform_config, mode="r")
note over soma: Extract tiledb_config from platform_config
soma -> clib : SOMAArrayReader(uri, tiledb_config)
clib -> sr ** : SOMAArrayReader(uri, tiledb_config)
sr++
note over sr: Open array using timestamp in tiledb_config

sr -> mq ** : ManagedQuery(array)
mq ++
soma -> py : a

note across: Mulitple reads to the same open array
loop Multiple reads
    py -> soma : a.read(ids, column_names, value_filter,\n batch_size, result_order)
    soma -> clib : reset(column_names, value_filter\n batch_size, result_order)
    clib -> sr : reset(column_names,\n batch_size, result_order)
    sr -> mq : reset()
    sr -> mq : select_columns()
    sr -> mq : set_layout()

    clib -> sr : set_condition()
    sr -> mq : set_condition()

    soma -> clib : set_dim_points()
    clib -> sr : set_dim_points()
    sr -> mq : set_dim_points()

    soma -> clib : set_dim_ranges()
    clib -> sr : set_dim_ranges()
    sr -> mq : set_dim_ranges()

    soma -> clib : submit()
    clib -> sr : submit()
    sr -> mq : submit()
    soma -> py : iter


    loop while iter returns data
        py -> soma : iter.next()
        soma -> clib : read_next()
        clib -> sr : read_next()
        sr -> mq : results()
        mq -> sr : data [ArrayBuffers]
        sr -> clib : data [ArrayBuffers]
        clib -> soma : data [Arrow Table]
        soma -> py : data [Arrow Table]
    end
end

note across: Delete SOMASparseNdArray instance

py -> soma : a.close()
soma -> clib : close()
clib -> sr - - : ~SOMAArrayReader()
sr -> mq - - : ~ManagedQuery()
note over mq : Array closed

@enduml

PlantUML version 1.2022.13(Sat Nov 19 08:22:17 EST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>