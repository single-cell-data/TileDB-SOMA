<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Convert a Seurat Sub-Object to a SOMA Object, returned opened for write — write_soma_seurat_sub_objects • tiledbsoma</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Convert a Seurat Sub-Object to a SOMA Object, returned opened for write — write_soma_seurat_sub_objects"><meta name="description" content="Various helpers to write Seurat sub-objects to SOMA objects.."><meta property="og:description" content="Various helpers to write Seurat sub-objects to SOMA objects.."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tiledbsoma</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><h6 class="dropdown-header" data-toc-skip>SOMA Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/soma-objects.html">SOMA Objects Overview</a></li>
    <li><a class="dropdown-item" href="../articles/soma-reading.html">Reading From SOMA Objects</a></li>
    <li><a class="dropdown-item" href="../articles/soma-shapes.html">SOMA shapes</a></li>
    <li><a class="dropdown-item" href="../articles/soma-experiment-queries.html">Querying a SOMA Experiment</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>SOMA Configuration</h6></li>
    <li><a class="dropdown-item" href="../articles/UsingPlatformConfig.html">Using PlatformConfig</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/single-cell-data/TileDB-SOMA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Convert a <span class="pkg">Seurat</span> Sub-Object to a SOMA Object, returned opened for write</h1>
      <small class="dont-index">Source: <a href="https://github.com/single-cell-data/TileDB-SOMA/blob/2.3.0/R/write_seurat.R" class="external-link"><code>R/write_seurat.R</code></a></small>
      <div class="d-none name"><code>write_soma_seurat_sub.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Various helpers to write <span class="pkg">Seurat</span> sub-objects to SOMA objects..</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'Assay'</span></span>
<span><span class="fu"><a href="write_soma.html">write_soma</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  uri <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">soma_parent</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  ingest_mode <span class="op">=</span> <span class="st">"write"</span>,</span>
<span>  platform_config <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tiledbsoma_ctx <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  context <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'Assay5'</span></span>
<span><span class="fu"><a href="write_soma.html">write_soma</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  uri <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">soma_parent</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  ingest_mode <span class="op">=</span> <span class="st">"write"</span>,</span>
<span>  platform_config <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tiledbsoma_ctx <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  context <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'DimReduc'</span></span>
<span><span class="fu"><a href="write_soma.html">write_soma</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  uri <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">soma_parent</span>,</span>
<span>  fidx <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nfeatures <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  ingest_mode <span class="op">=</span> <span class="st">"write"</span>,</span>
<span>  platform_config <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tiledbsoma_ctx <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  context <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'Graph'</span></span>
<span><span class="fu"><a href="write_soma.html">write_soma</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">uri</span>,</span>
<span>  <span class="va">soma_parent</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  ingest_mode <span class="op">=</span> <span class="st">"write"</span>,</span>
<span>  platform_config <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tiledbsoma_ctx <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  context <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'SeuratCommand'</span></span>
<span><span class="fu"><a href="write_soma.html">write_soma</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  uri <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">soma_parent</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  ingest_mode <span class="op">=</span> <span class="st">"write"</span>,</span>
<span>  platform_config <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tiledbsoma_ctx <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  context <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <span class="pkg">Seurat</span> sub-object (eg. an
<code><a href="https://satijalab.github.io/seurat-object/reference/Assay-class.html" class="external-link">Assay</a></code>, a <code><a href="https://satijalab.github.io/seurat-object/reference/DimReduc-class.html" class="external-link">DimReduc</a></code>,
or a <code><a href="https://satijalab.github.io/seurat-object/reference/Graph-class.html" class="external-link">Graph</a></code>).</p></dd>


<dt id="arg-uri">uri<a class="anchor" aria-label="anchor" href="#arg-uri"></a></dt>
<dd><p>URI for resulting SOMA object.</p></dd>


<dt id="arg-soma-parent">soma_parent<a class="anchor" aria-label="anchor" href="#arg-soma-parent"></a></dt>
<dd><p>The parent <a href="SOMACollection.html">collection</a>;
for the <code>DimReduc</code> and <code>Graph</code> methods, this <strong>must</strong> be a
<a href="SOMAMeasurement.html">measurement</a> for the assay <code>x</code>
was generated from.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed to other methods</p></dd>


<dt id="arg-ingest-mode">ingest_mode<a class="anchor" aria-label="anchor" href="#arg-ingest-mode"></a></dt>
<dd><p>Ingestion mode when creating the SOMA; choose from:</p><ul><li><p>“<code>write</code>”: create a new SOMA and error if it already
exists.</p></li>
<li><p>“<code>resume</code>”: attempt to create a new SOMA; if it already
exists, simply open it for writing.</p></li>
</ul></dd>


<dt id="arg-platform-config">platform_config<a class="anchor" aria-label="anchor" href="#arg-platform-config"></a></dt>
<dd><p>Optional <a href="PlatformConfig.html">platform
configuration</a>.</p></dd>


<dt id="arg-tiledbsoma-ctx">tiledbsoma_ctx<a class="anchor" aria-label="anchor" href="#arg-tiledbsoma-ctx"></a></dt>
<dd><p>Optional (DEPRECATED) <code><a href="SOMATileDBContext.html">SOMATileDBContext</a></code>.</p></dd>


<dt id="arg-context">context<a class="anchor" aria-label="anchor" href="#arg-context"></a></dt>
<dd><p>Optional <code>SOMAContext</code> object used for TileDB operations.
If a context is not provided, then the default context will be used. Call
<code>set_default_context</code> once before other SOMA operations to configure
the default context.</p></dd>


<dt id="arg-relative">relative<a class="anchor" aria-label="anchor" href="#arg-relative"></a></dt>
<dd><p><strong>[Internal use only]</strong> Is <code>uri</code>
relative or absolute.</p></dd>


<dt id="arg-fidx">fidx<a class="anchor" aria-label="anchor" href="#arg-fidx"></a></dt>
<dd><p>An integer vector describing the location of features in
<code>SeuratObject::Loadings(x)</code> with relation to <code>soma_parent</code>
(eg. <code>match(rownames(Loadings(x)), rownames(assay))</code>).</p></dd>


<dt id="arg-nfeatures">nfeatures<a class="anchor" aria-label="anchor" href="#arg-nfeatures"></a></dt>
<dd><p>The number of features present in <code>soma_parent</code>
(eg. <code>nrow(assay)</code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>Assay</code> and <code>Assay5</code> methods: a
<code><a href="SOMAMeasurement.html">SOMAMeasurement</a></code> with the data from <code>x</code>,
returned opened for write.</p>
<p><code>DimReduc</code> and <code>Graph</code> methods: invisibly returns
<code>soma_parent</code>, opened for write, with the values of <code>x</code>
added to it.</p>
    </div>
    <div class="section level2">
    <h2 id="writing-v-assays">Writing v3 <code><a href="https://satijalab.github.io/seurat-object/reference/Assay-class.html" class="external-link">Assay</a>s</code><a class="anchor" aria-label="anchor" href="#writing-v-assays"></a></h2>


<p><span class="pkg">Seurat</span> <code><a href="https://satijalab.github.io/seurat-object/reference/Assay-class.html" class="external-link">Assay</a></code> objects are written out as
individual <a href="SOMAMeasurement.html">measurements</a>:</p><ul><li><p>the “<code>data</code>” matrix is written out as a
<a href="SOMASparseNDArray.html">sparse array</a> called
“<code>data</code>” within the “<code>X</code>” group.</p></li>
<li><p>the “<code>counts</code>” matrix, if not
<a href="https://satijalab.github.io/seurat-object/reference/IsMatrixEmpty.html" class="external-link">empty</a>, is written out as a
<a href="SOMASparseNDArray.html">sparse array</a> called
“<code>counts</code>” within the “<code>X</code>” group.</p></li>
<li><p>the “<code>scale.data</code>” matrix, if not
<a href="https://satijalab.github.io/seurat-object/reference/IsMatrixEmpty.html" class="external-link">empty</a>, is written out as a
<a href="SOMASparseNDArray.html">sparse array</a> called
“<code>scale_data</code>” within the “<code>X</code>” group.</p></li>
<li><p>feature-level metadata is written out as a
<a href="SOMADataFrame.html">data frame</a> called “<code>var</code>”.</p></li>
</ul><p>Expression matrices are transposed (cells as rows) prior to writing. All
other slots, including results from extended assays (eg. <code>SCTAssay</code>,
<code>ChromatinAssay</code>) are lost.</p>
<div class="section">
<h3 id="performance-considerations">Performance Considerations<a class="anchor" aria-label="anchor" href="#performance-considerations"></a></h3>
<p>Ingestion of very large dense layers, such as <code>scale.data</code>, can be
memory intensive. For better performance, users can remove these layers
prior to ingestion and regenerate them after export, or ingest them
separately as dense arrays for those who need to persist the exact matrix</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="co"># Using SeuratObject v5 syntax on a v3 `Assay`</span></span>
<span><span class="co"># Cache the layer for separate ingestion, skip if planning to regenerate</span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">object</span><span class="op">[[</span><span class="st">"ASSAY"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">scale.data</span></span>
<span></span>
<span><span class="co"># Remove the `scale.data` layer</span></span>
<span><span class="va">object</span><span class="op">[[</span><span class="st">"ASSAY"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">scale.data</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># Ingest the smaller object</span></span>
<span><span class="va">uri</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_soma.html">write_soma</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"/path/to/soma"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ingest the `scale.data` layer densely; needed only if persistence</span></span>
<span><span class="co"># of the data is paramount</span></span>
<span><span class="co"># Pad the `scale.data` layer so that its soma join IDs match the experiment</span></span>
<span><span class="va">padded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"numeric"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">object</span><span class="op">[[</span><span class="st">"ASSAY"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">object</span><span class="op">[[</span><span class="st">"ASSAY"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">object</span><span class="op">[[</span><span class="st">"ASSAY"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">rowidx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">object</span><span class="op">[[</span><span class="st">"ASSAY"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">colidx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">object</span><span class="op">[[</span><span class="st">"ASSAY"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">padded</span><span class="op">[</span><span class="va">rowidx</span>, <span class="va">colidx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mat</span></span>
<span></span>
<span><span class="co"># Use `write_soma()` to ingest densely and register it within the `uns`</span></span>
<span><span class="co"># collection; this may need to be created manually if the original</span></span>
<span><span class="co"># object does not contain command logs</span></span>
<span><span class="va">exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOMAExperimentOpen.html">SOMAExperimentOpen</a></span><span class="op">(</span><span class="va">uri</span>, <span class="st">"WRITE"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="st">"uns"</span>, <span class="va">exp</span><span class="op">$</span><span class="fu">names</span><span class="op">(</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="fl">0L</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># For `tiledb://` URIs, set the URI for the new collection manually rather</span></span>
<span>  <span class="co"># than relying on `file.path()`</span></span>
<span>  <span class="va">uns</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOMACollectionCreate.html">SOMACollectionCreate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">exp</span><span class="op">$</span><span class="va">uri</span>, <span class="st">"uns"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">exp</span><span class="op">$</span><span class="fu">add_new_collection</span><span class="op">(</span><span class="va">uns</span>, <span class="st">"uns"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">arr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_soma.html">write_soma</a></span><span class="op">(</span></span>
<span>  <span class="va">padded</span>,</span>
<span>  <span class="st">"scale_data"</span>,</span>
<span>  soma_parent <span class="op">=</span> <span class="va">exp</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"uns"</span><span class="op">)</span>,</span>
<span>  sparse <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  key <span class="op">=</span> <span class="st">"scale_data"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">arr</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">exp</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p>Please note that dense arrays cannot be read in using the
<code><a href="SOMAExperimentAxisQuery.html">SOMAExperimentAxisQuery</a></code> mechanism; use
<code><a href="SOMADenseNDArray.html">SOMADenseNDArray</a>$read_dense_matrix</code>, remembering to transpose
before adding back to a <code>Seurat</code> object</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="writing-v-assays-1">Writing v5 <code>Assays</code><a class="anchor" aria-label="anchor" href="#writing-v-assays-1"></a></h2>


<p><span class="pkg">Seurat</span> v5 <code><a href="https://satijalab.github.io/seurat-object/reference/Assay5-class.html" class="external-link">Assays</a>s</code> are written
out as individual <a href="SOMAMeasurement.html">measurements</a>:</p><ul><li><p>the layer matrices are written out as
<a href="SOMASparseNDArray.html">sparse arrays</a> within the
“<code>X</code>” group.</p></li>
<li><p>feature-level metadata is written out as a
<a href="SOMADataFrame.html">data frame</a> called “<code>var</code>”.</p></li>
</ul><p>Expression matrices are transposed (cells as rows) prior to writing. All
other slots, including results from extended assays (eg. <code>SCTAssay</code>,
<code>ChromatinAssay</code>) are lost.<br>
The following bits of metadata are written in various parts of the measurement</p><ul><li><p>“<code>soma_ecosystem_seurat_assay_version</code>”: written at the
measurement level; indicates the Seurat assay version.
Set to “<code>v5</code>”.</p></li>
<li><p>“<code>soma_ecosystem_seurat_v5_default_layers</code>”: written at
the “<code>X</code>” group level; indicates the
<a href="https://satijalab.github.io/seurat-object/reference/DefaultLayer.html" class="external-link">default layers</a>.</p></li>
<li><p>“<code>soma_ecosystem_seurat_v5_ragged</code>”: written at the
“<code>X/&lt;layer&gt;</code>” array level; with a value of
“<code>ragged</code>”, indicates whether or not the layer is ragged.</p></li>
<li><p>“<code>soma_r_type_hint</code>”: written at the
“<code>X/&lt;layer&gt;</code>” array level; indicates the <span style="R">R</span> class and
defining package (for S4 classes) of the original layer.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="writing-dimreducs">Writing <code><a href="https://satijalab.github.io/seurat-object/reference/DimReduc-class.html" class="external-link">DimReduc</a>s</code><a class="anchor" aria-label="anchor" href="#writing-dimreducs"></a></h2>


<p><span class="pkg">Seurat</span> <code><a href="https://satijalab.github.io/seurat-object/reference/DimReduc-class.html" class="external-link">DimReduc</a></code> objects are written out
to the “<code>obsm</code>” and “<code>varm</code>” groups of a
<a href="SOMAMeasurement.html">measurement</a>:</p><ul><li><p>cell embeddings are written out as a
<a href="SOMASparseNDArray.html">sparse matrix</a> in the
“<code>obsm</code>” group.</p></li>
<li><p>feature loadings, if not <a href="https://satijalab.github.io/seurat-object/reference/IsMatrixEmpty.html" class="external-link">empty</a>,
are written out as a <a href="SOMASparseNDArray.html">sparse matrix</a> in
the “<code>varm</code>” groups; loadings are padded with <code>NAs</code>
to include all features.</p></li>
</ul><p>Dimensional reduction names are translated to AnnData-style names (eg.
“<code>pca</code>” becomes <code>X_pca</code> for embeddings and
“<code>PCs</code>” for loadings). All other slots, including projected
feature loadings and jackstraw information, are lost.</p>
    </div>
    <div class="section level2">
    <h2 id="writing-graphs">Writing <code><a href="https://satijalab.github.io/seurat-object/reference/Graph-class.html" class="external-link">Graph</a>s</code><a class="anchor" aria-label="anchor" href="#writing-graphs"></a></h2>


<p><span class="pkg">Seurat</span> <code><a href="https://satijalab.github.io/seurat-object/reference/Graph-class.html" class="external-link">Graph</a></code> objects are
written out as <a href="SOMASparseNDArray.html">sparse matrices</a>
to the “<code>obsp</code>” group of a
<a href="SOMAMeasurement.html">measurement</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="writing-seuratcommands">Writing <code><a href="https://satijalab.github.io/seurat-object/reference/SeuratCommand-class.html" class="external-link">SeuratCommand</a>s</code><a class="anchor" aria-label="anchor" href="#writing-seuratcommands"></a></h2>


<p><span class="pkg">Seurat</span> <a href="https://satijalab.github.io/seurat-object/reference/SeuratCommand-class.html" class="external-link">command logs</a> are written out
as <a href="SOMADataFrame.html">data frames</a> to the
“<code>seurat_commands</code>” group of a
<a href="SOMACollection.html">collection</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">uri</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">local_tempfile</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"seurat-sub"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pbmc_small"</span>, package <span class="op">=</span> <span class="st">"SeuratObject"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">pbmc_small</span> <span class="op">&lt;-</span> <span class="fu">SeuratObject</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/UpdateSeuratObject.html" class="external-link">UpdateSeuratObject</a></span><span class="op">(</span><span class="va">pbmc_small</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Validating object structure</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Updating object slots</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Ensuring keys are in the proper structure</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Updating matrix keys for DimReduc ‘pca’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Updating matrix keys for DimReduc ‘tsne’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Ensuring keys are in the proper structure</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Ensuring feature names don't have underscores or pipes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Updating slots in RNA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Updating slots in RNA_snn</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting default assay of RNA_snn to RNA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Updating slots in pca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Updating slots in tsne</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting tsne DimReduc to global</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting assay used for NormalizeData.RNA to RNA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting assay used for ScaleData.RNA to RNA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting assay used for RunPCA.RNA to RNA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting assay used for BuildSNN.RNA.pca to RNA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No assay information could be found for FindClusters</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting assay used for RunTSNE.pca to RNA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting assay used for JackStraw.RNA.pca to RNA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting assay used for ScoreJackStraw.pca to RNA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting assay used for ProjectDim.RNA.pca to RNA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting assay used for FindVariableFeatures.RNA to RNA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Validating object structure for Assay ‘RNA’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Validating object structure for Graph ‘RNA_snn’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Validating object structure for DimReduc ‘pca’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Validating object structure for DimReduc ‘tsne’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Object representation is consistent with the most current Seurat version</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="SOMACollectionCreate.html">SOMACollectionCreate</a></span><span class="op">(</span><span class="va">uri</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Write a v3 Assay</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">assay</span> <span class="op">&lt;-</span> <span class="va">pbmc_small</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Assay data with 230 features for 80 cells</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Top 10 variable features:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  PPBP, IGLL5, VDAC3, CD1C, AKR1C3, PF4, MYL9, GNLY, TREML1, CA2 </span>
<span class="r-in"><span><span class="op">(</span><span class="va">ms</span> <span class="op">&lt;-</span> <span class="fu"><a href="write_soma.html">write_soma</a></span><span class="op">(</span><span class="va">assay</span>, <span class="st">"RNA"</span>, soma_parent <span class="op">=</span> <span class="va">col</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;SOMAMeasurement&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   uri: /tmp/Rtmpfr8mYm/seurat-sub2a7e7537a170/RNA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   arrays: var </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   groups: X </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Write a v5 Assay</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">assay5</span> <span class="op">&lt;-</span> <span class="fu">methods</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">pbmc_small</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"Assay5"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Assay (v5) data with 230 features for 80 cells</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Top 10 variable features:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  PPBP, IGLL5, VDAC3, CD1C, AKR1C3, PF4, MYL9, GNLY, TREML1, CA2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Layers:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  data, counts, scale.data </span>
<span class="r-in"><span><span class="op">(</span><span class="va">ms5</span> <span class="op">&lt;-</span> <span class="fu"><a href="write_soma.html">write_soma</a></span><span class="op">(</span><span class="va">assay5</span>, <span class="st">"RNA5"</span>, soma_parent <span class="op">=</span> <span class="va">col</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;SOMAMeasurement&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   uri: /tmp/Rtmpfr8mYm/seurat-sub2a7e7537a170/RNA5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   arrays: var </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   groups: X </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ms5</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Write a dimensional reduction</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">tsne</span> <span class="op">&lt;-</span> <span class="va">pbmc_small</span><span class="op">[[</span><span class="st">"tsne"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="write_soma.html">write_soma</a></span><span class="op">(</span><span class="va">tsne</span>, soma_parent <span class="op">=</span> <span class="va">ms</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ms</span><span class="op">$</span><span class="va">obsm</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;SOMACollection&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   uri: /tmp/Rtmpfr8mYm/seurat-sub2a7e7537a170/RNA/obsm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   arrays: X_tsne </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Write a Seurat Graph</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">snn</span> <span class="op">&lt;-</span> <span class="va">pbmc_small</span><span class="op">[[</span><span class="st">"RNA_snn"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A Graph object containing 80 cells</span>
<span class="r-in"><span><span class="fu"><a href="write_soma.html">write_soma</a></span><span class="op">(</span><span class="va">snn</span>, <span class="st">"snn"</span>, soma_parent <span class="op">=</span> <span class="va">ms</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ms</span><span class="op">$</span><span class="va">obsp</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;SOMACollection&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   uri: /tmp/Rtmpfr8mYm/seurat-sub2a7e7537a170/RNA/obsp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   arrays: snn </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Write a Seurat command log</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">cmd</span> <span class="op">&lt;-</span> <span class="va">pbmc_small</span><span class="op">[[</span><span class="st">"NormalizeData.RNA"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Command: NormalizeData(object = pbmc_small)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time: 2018-08-27 20:32:17.136699</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> assay : RNA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> normalization.method : LogNormalize </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scale.factor : 10000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> verbose : TRUE </span>
<span class="r-in"><span><span class="fu"><a href="write_soma.html">write_soma</a></span><span class="op">(</span><span class="va">cmd</span>, <span class="st">"NormalizeData.RNA"</span>, soma_parent <span class="op">=</span> <span class="va">col</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">logs</span> <span class="op">&lt;-</span> <span class="va">col</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"seurat_commands"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;SOMACollection&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   uri: /tmp/Rtmpfr8mYm/seurat-sub2a7e7537a170/seurat_commands</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   arrays: NormalizeData.RNA </span>
<span class="r-in"><span><span class="va">logs</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"NormalizeData.RNA"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;SOMADataFrame&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   uri: /tmp/Rtmpfr8mYm/seurat-sub2a7e7537a170/seurat_commands/NormalizeData.RNA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   dimensions: soma_joinid </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   attributes: values </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">col</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Hoffman, Aaron Wolen, TileDB, Inc..</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

